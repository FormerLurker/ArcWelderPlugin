<!--###############################################################################
# Arc Welder: Anti-Stutter
#
# A plugin for OctoPrint that converts G0/G1 commands into G2/G3 commands where possible and ensures that the tool
# paths don't deviate by more than a predefined resolution.  This compresses the gcode file sice, and reduces reduces
# the number of gcodes per second sent to a 3D printer that supports arc commands (G2 G3)
#
# Copyright (C) 2020  Brad Hochgesang
# #################################################################################
# This program is free software:
# you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by
# the Free Software Foundation, either version 3 of the License, or (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with this program.  If not, see the following:
# https://github.com/FormerLurker/ArcWelderPlugin/blob/master/LICENSE
#
# You can contact the author either through the git-hub repository, or at the
# following email address: FormerLurker@pm.me
##################################################################################-->
<div id="tab_plugin_arc_welder_controls" class="form-horizontal arc-welder">
    <div data-bind="visible: plugin_settings.feature_settings.current_run_configuration_visible">
        <H4>
            <a href="#" class="no-underline" data-bind="arc_welder_toggle: { class_showing: 'fa-caret-down', class_hiding: 'fa-caret-right', container: '#arc_welder_current_run_configuration', toggle_observable: run_configuration_visible }">
                Current Run Configuration <i class="fa fa-no-shadow fa-caret-down"></i>
            </a>
        </H4>
        <div id="arc_welder_current_run_configuration" class="short-rows">
            <div data-bind="visible: plugin_settings.enabled">
                <div class="row-fluid">
                    <div class="span4 text-right">
                        <strong>Plugin Status:</strong>
                    </div>
                    <div class="span8">
                        Enabled
                    </div>
                </div>
                <div class="row-fluid">
                    <div class="span4 text-right">
                        <strong>Pre-Processing Types:</strong>
                    </div>
                    <div class="span8">
                        <span data-bind="visible: auto_pre_processing_enabled() && !manual_pre_processing_enabled()">Automatic Processing Only</span>
                        <span data-bind="visible: !auto_pre_processing_enabled() && manual_pre_processing_enabled()">Manual Processing Only</span>
                        <span data-bind="visible: auto_pre_processing_enabled() && manual_pre_processing_enabled()">Automatic and Manual Processing Enabled</span>
                    </div>
                </div>
                <div class="row-fluid">
                    <div class="span4 text-right">
                        <strong>G90 Influences Extruder:</strong>
                    </div>
                    <div class="span8">
                        <span data-bind="visible: plugin_settings.use_octoprint_settings"><span
                                data-bind="text: settings.settings.feature.g90InfluencesExtruder"></span> (using octoprint settings)</span>
                        <span data-bind="visible: !plugin_settings.use_octoprint_settings()"><span
                                data-bind="text: plugin_settings.g90_g91_influences_extruder"></span></span>
                    </div>
                </div>
                <div class="row-fluid">
                    <div class="span4 text-right">
                        <strong>Resolution:</strong>
                    </div>
                    <div class="span8">
                        <span data-bind="text: plugin_settings.resolution_mm"></span>mm&nbsp;(max deviation <strong>&#177;<span data-bind="text:  plugin_settings.resolution_mm()/2.0"></span>mm</strong>)
                    </div>
                </div>
                <div class="row-fluid">
                    <div class="span4 text-right">
                        <strong>Path Tolerance:</strong>
                    </div>
                    <div class="span8">
                        <span data-bind="text: plugin_settings.path_tolerance_percent"></span>%
                    </div>
                </div>
                <div class="row-fluid">
                    <div class="span4 text-right">
                        <strong>Maximum Arc Radius:</strong>
                    </div>
                    <div class="span8">
                        <span data-bind="text: plugin_settings.max_radius_mm"></span>mm
                    </div>
                </div>
                <div class="row-fluid">
                    <div class="span4 text-right">
                        <strong>Output File Name:</strong>
                    </div>
                    <div class="span8">
                        <span data-bind="visible: plugin_settings.overwrite_source_file">Gcode files will be overwritten after processing.</span>
                        <div data-bind="visible: !plugin_settings.overwrite_source_file()">
                            <span data-bind="visible: plugin_settings.target_postfix() != '' && plugin_settings.target_prefix() != ''">
                                <strong><span
                                data-bind="text: plugin_settings.target_prefix"></span></strong>source_file_name<strong><span data-bind="text: plugin_settings.target_postfix"></span></strong>.gcode
                            </span>
                            <span data-bind="visible: plugin_settings.target_postfix() == '' && plugin_settings.target_prefix() != ''">
                                <strong><span data-bind="text: plugin_settings.target_prefix"></span></strong>source_file_name.gcode
                            </span>
                            <span data-bind="visible: plugin_settings.target_postfix() != '' && plugin_settings.target_prefix() == ''">
                                source_file_name<strong><span data-bind="text: plugin_settings.target_postfix"></span></strong>.gcode
                            </span>
                            <span data-bind="visible: plugin_settings.target_postfix() == '' && plugin_settings.target_prefix() == ''" class="text-error">
                                Overwrite source file
                            </span>
                        </div>

                    </div>
                </div>
                <div class="row-fluid">
                    <div class="span4 text-right">
                        <strong>Delete Output File:</strong>
                    </div>
                    <div class="span8">
                        <div data-bind="visible: plugin_settings.overwrite_source_file() || (plugin_settings.target_postfix() == '' && plugin_settings.target_prefix() == '')">
                            <span>The source file will be overwritten, based on other the other plugin settings.</span>
                        </div>
                        <div data-bind="visible: !(plugin_settings.overwrite_source_file() || (plugin_settings.target_postfix() == '' && plugin_settings.target_prefix() == ''))">
                            <span data-bind="text: source_file_delete_description"></span>
                        </div>

                    </div>
                </div>
                <div class="row-fluid">
                    <div class="span4 text-right">
                        <strong>Print After Processing:</strong>
                    </div>
                    <div class="span8">
                        <span data-bind="visible: print_auto_processed_file() && !print_manual_processed_file()">After Automatic Processing Only</span>
                        <span data-bind="visible: !print_auto_processed_file() && print_manual_processed_file()">After Manual Processing Only</span>
                        <span data-bind="visible: print_auto_processed_file() && print_manual_processed_file()">Always</span>
                        <span data-bind="visible: !print_auto_processed_file() && !print_manual_processed_file()">Disabled</span>
                    </div>
                </div>
                <div class="row-fluid">
                    <div class="span4 text-right">
                        <strong>Select After Processing:</strong>
                    </div>
                    <div class="span8">
                        <span data-bind="visible: select_auto_processed_file() && !select_manual_processed_file()">After Automatic Processing Only</span>
                        <span data-bind="visible: !select_auto_processed_file() && select_manual_processed_file()">After Manual Processing Only</span>
                        <span data-bind="visible: select_auto_processed_file() && select_manual_processed_file()">Always</span>
                        <span data-bind="visible: !select_auto_processed_file() && !select_manual_processed_file()">Disabled</span>
                    </div>
                </div>
            </div>
            <div data-bind="visible: !plugin_settings.enabled()">
                <dl class="row-fluid">
                    <div class="span4 text-right"><strong>Plugin Status:</strong></div>
                    <div class="span8">
                        Disabled - Arc Welder is completely disabled
                    </div>
                </dl>
            </div>
            <div class="row-fluid">
                <div class="span12 text-right">
                    <button class="btn btn-primary" data-bind="click: function() {ArcWelder.openArcWelderSettings('settings');}"
                            title="Open Arc Welder settings">
                        Edit Settings
                    </button>
                </div>
            </div>
            <hr/>
        </div>
    </div>
    <div data-bind="visible: plugin_settings.feature_settings.check_firmware() != ArcWelder.CHECK_FIRMWARE_DISABLED">
        <H4>
            <a href="#" class="no-underline" data-bind="arc_welder_toggle: { class_showing: 'fa-caret-down', class_hiding: 'fa-caret-right', container: '#arc_welder_firmware_compatibility', toggle_observable: firmware_compatibility_visible }, css: {'text-error':firmware_info.has_errors(), 'text-warning': !firmware_info.has_errors() && firmware_info.has_warnings()}">
                Firmware Compatibility&nbsp;<i data-bind="visible: firmware_info.has_errors() || firmware_info.has_warnings()" class="fa fa-exclamation">&nbsp;</i><i class="fa fa-no-shadow fa-caret-down"></i>
            </a>
        </H4>
        <div id="arc_welder_firmware_compatibility">
            <div class="row-fluid">
                <div class="span5">
                    <div data-bind="visible: !firmware_info.loaded()">
                        <p class="text-error"><strong>Firmware Info Loading</strong></p>
                        <p>Please wait while firmware info loads.</p>
                    </div>
                    <div data-bind="visible: firmware_info.loaded() && firmware_info.success()===null">
                        <p class="text-error"><strong>No Firmware Info Available</strong></p>
                        <p>Please check your firmware by clicking the <strong>Check Firmware</strong> button.</p>
                    </div>
                    <div id="arc_welder_firmware_info" data-bind="visible: (firmware_info.success() || firmware_info.success() === null)">
                        <button type="button" class="btn full-width"
                            data-bind="click: function(){firmware_info.checkFirmware();}, disable: firmware_info.checking_firmware() || !firmware_info.loaded()"
                            title="Check your firmware for compatibility with Arc Welder.">
                            <i class="fa fa-spinner fa-spin" data-bind="visible: firmware_info.checking_firmware"></i><span>Check Firmware</span>
                        </button>
                        <div class="short-rows">
                            <div class="row-fluid">
                                <div class="span6 text-right">Name:</div>
                                <div class="span6"><span data-bind="text: firmware_info.type() ?? 'unknown'"></span></div>
                            </div>
                            <div class="row-fluid">
                                <div class="span6 text-right">Version:</div>
                                <div class="span6"><span data-bind="text: firmware_info.version() ?? 'unknown'"></span></div>
                            </div>
                            <div class="row-fluid" data-bind="visible: firmware_info.build_date() !== null">
                                <div class="span6 text-right">Build Date:</div>
                                <div class="span6"><span data-bind="text: firmware_info.build_date()"></span></div>
                            </div>
                            <div data-bind="attr: {class: firmware_info.supported.class}">
                                <div class="row-fluid">
                                    <div class="span6 text-right">Supported:</div>
                                    <div class="span6">
                                        <span data-bind="text: firmware_info.supported.formatted"></span>
                                    </div>
                                </div>
                            </div>
                            <div data-bind="visible: firmware_info.supported() !== false || firmware_info.arcs_enabled() === true, attr: {class: firmware_info.recommended.class}">
                                <div class="row-fluid">
                                    <div class="span6 text-right">Recommended:</div>
                                    <div class="span6">
                                        <span data-bind="text: firmware_info.recommended.formatted"></span>
                                    </div>
                                </div>
                            </div>
                            <div data-bind="attr: {class: firmware_info.g2_g3_supported.class}">
                                <div class="row-fluid">
                                    <div class="span6 text-right">Arcs Supported:</div>
                                    <div class="span6">
                                        <span data-bind="text: firmware_info.g2_g3_supported.formatted"></span>
                                    </div>
                                </div>
                            </div>
                            <div data-bind="attr: {class: firmware_info.arcs_enabled.class}">
                                <div class="row-fluid">
                                    <div class="span6 text-right">Arcs Enabled:</div>
                                    <div class="span6">
                                        <span data-bind="text: firmware_info.arcs_enabled.formatted"></span>
                                    </div>
                                </div>
                            </div>
                            <div data-bind="visible: !!firmware_info.notes()">
                                <div class="row-fluid">
                                    <div class="span6 text-right">Notes:</div>
                                    <div class="span6">
                                        <span data-bind="text: firmware_info.arcs_enabled.notes"></span>
                                    </div>
                                </div>
                            </div>
                            <div data-bind="visible: !!firmware_info.previous_notes()">
                                <div class="row-fluid">
                                    <div class="span6 text-right">Notes:</div>
                                    <div class="span6">
                                        <span data-bind="text: firmware_info.previous_notes.notes"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="span7">
                    <div class="row-fluid text-error" data-bind="visible: firmware_info.has_errors">
                        <div class="span12">
                            <h5>Errors</h5>
                            <ul data-bind="foreach: firmware_info.errors">
                                <li data-bind="text: $data"></li>
                            </ul>
                        </div>
                    </div>
                    <div class="row-fluid text-warning" data-bind="visible: firmware_info.has_warnings() && ! firmware_info.has_errors()">
                        <div class="span12">
                            <h5>Warnings</h5>
                            <ul data-bind="foreach: firmware_info.warnings">
                                <li data-bind="text: $data"></li>
                            </ul>
                        </div>
                    </div>
                    <div class="row-fluid text-success" data-bind="visible: (firmware_info.has_warnings()===false && firmware_info.has_warnings()===false)">
                        <div class="span12">
                            Your firmware is good to go!
                        </div>
                    </div>
                </div>
            </div>
            <hr/>
        </div>
    </div>
    <div id="arc-welder-no-stats-div" data-bind="visible: !statistics_available()">
        <h4><a href="javaScript:void(0)" class="no-click no-underline">File Statistics Unavailable</a></h4>
    </div>
    <div data-bind="visible: statistics_available">
        <H4>
            <a href="#" class="no-underline" data-bind="arc_welder_toggle: { class_showing: 'fa-caret-down', class_hiding: 'fa-caret-right', container: '#arc-welder-stats-container', toggle_observable: file_statistics_visible }">
                Processed File Statistics <i class="fa fa-no-shadow fa-caret-down"></i>
            </a>
        </H4>
        <div id="arc-welder-stats-container">
            <div id="arc-welder-stats">
                <div class="row-fluid">
                    <div class="span12">
                        <h4>Arc-Welder Statistics for <span data-bind="text:selected_filename_title"></span> File</h4>
                    </div>
                </div>
                <div id="arc-welder-stats-text-div">
                    <div class="row-fluid">
                        <div class="span6">
                            <div class="row-fluid">
                                <div class="span3 text-right">
                                    <strong>Source:</strong>
                                </div>
                                <div class="span9 overflow-ellipsis">
                                    <sapn data-bind="text:statistics.source_filename, attr:{title:statistics.source_filename}"></sapn>
                                </div>
                            </div>
                            <div class="row-fluid">
                                <div class="span3 text-right">
                                    <strong>Lines:</strong>
                                </div>
                                <div class="span9">
                                    <span data-bind="text: statistics.lines_processed"></span>
                                </div>
                            </div>
                            <div class="row-fluid">
                                <div class="span3 text-right">
                                    <strong>Size:</strong>
                                </div>
                                <div class="span9">
                                    <span data-bind="text: statistics.source_file_size"></span>
                                </div>
                            </div>
                        </div>
                        <div class="span6">
                            <div class="row-fluid">
                                <div class="span3 text-right">
                                    <strong>Target:</strong>
                                </div>
                                <div class="span9 overflow-ellipsis">
                                    <span data-bind="text:selected_filename, attr:{title:selected_filename}"></span>
                                </div>
                            </div>

                            <div class="row-fluid">
                                <div class="span3 text-right">
                                    <strong>Lines:</strong>
                                </div>
                                <div class="span9">
                                    <span data-bind="text: statistics.lines_processed() - statistics.points_compressed()"></span>
                                </div>
                            </div>
                            <div class="row-fluid">
                                <div class="span3 text-right">
                                    <strong>Size:</strong>
                                </div>
                                <div class="span9">
                                    <span data-bind="text: statistics.target_file_size"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="span12">
                            <h5>Compression</h5>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="span6">
                            <div class="row-fluid">
                                <div class="span6 text-right">
                                    <strong>Points Compressed:</strong>
                                </div>
                                <div class="span6">
                                    <span data-bind="text: statistics.points_compressed"></span>
                                </div>
                            </div>
                        </div>
                        <div class="span6">
                            <div class="row-fluid">
                                <div class="span6 text-right">
                                    <strong>Arcs Created:</strong>
                                </div>
                                <div class="span6">
                                    <span data-bind="text: statistics.arcs_created"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="span6">
                            <div class="row-fluid">
                                <div class="span6 text-right">
                                    <strong>Ratio:</strong>
                                </div>
                                <div class="span6">
                                    <span data-bind="text: statistics.compression_ratio"></span>
                                </div>
                            </div>
                        </div>
                        <div class="span6">
                            <div class="row-fluid">
                                <div class="span6 text-right">
                                    <strong>Compression:</strong>
                                </div>
                                <div class="span6">
                                    <span data-bind="text: statistics.compression_percent"></span>%
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="span12">
                            <h5>Segment Length Statistics</h5>
                            <pre class="text-center" data-bind="text: statistics.segment_statistics_text"></pre>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <div class="row-fluid">
        <div class="span6">
            <small>
                <a href="javascript:void(0)" data-bind="click: function() {ArcWelder.openArcWelderSettings('about');}"
                   title="About Arc Welder"><i class="fa fa-info-circle">&nbsp;About</i></a>
                &nbsp;<a href="https://github.com/FormerLurker" target="_blank" title="FormerLurker&#146;s Github Page"><i
                    class="fa fa-github">&nbsp;Github</i></a>
                &nbsp;<a href="https://youtube.com/c/FormerLurker" target="_blank"
                         title="FormerLurker&#146;s YouTube Channel"><i class="fa fa-youtube">&nbsp;YouTube</i></a>
                &nbsp;<a href="https://paypal.me/formerlurker" target="_blank" title="Donate via PayPal"><i
                    class="fa fa-paypal">&nbsp;PayPal</i></a>
                &nbsp;<a href="https://www.patreon.com/bePatron?u=9588101" target="_blank" title="Become a patron"><i
                    class="fa fa-patreon">&nbsp;Patreon</i></a>
            </small>
        </div>
        <div class="span6 text-right muted">
            <a target="_blank" data-bind="visible: github_link() != null, attr: { href: github_link}">
                Arc Welder&nbsp;<i data-bind="text:version_text"></i>
            </a>
            <span data-bind="visible: github_link() == null">
                    <small>
                        Arc Welder&nbsp;<i data-bind="text:version_text"></i>
                    </small>
                </span>
        </div>
    </div>
</div>